<nav>
    <a onclick="switchTab('home')" class="logo"><i class="bi bi-hexagon-fill"></i> SOV.NETWORK</a>
    <div class="nav-links">
        <a id="link-home" onclick="switchTab('home')" class="active-link">Technology</a>
        
        <a href="explorer.html" target="_blank" id="link-explorer">Explorer</a>
        
        <a id="link-vault" onclick="switchTab('vault')" class="btn-prime" style="padding: 0.6rem 1.8rem; font-size: 0.85rem; color: white !important;">Access Vault</a>
    </div>
</nav>

<script>
    let currentInput = "";
    let loginAttempts = 0;
    let lockoutTime = 0;
    const MAX_ATTEMPTS = 3;
    const LOCKOUT_DURATION = 60000;
    const CORRECT_PIN = "123";

    const vaultMsg = document.getElementById('vault-msg');
    const pinView = document.getElementById('pin-view');
    const vStatus = document.getElementById('v-status');
    const isNewUser = !localStorage.getItem('sov_id_created');

    // ðŸŸ¢ UPDATE 2: Robust Handshake Logic
    function successRedirect(msg) {
        localStorage.setItem('sov_id_created', 'true');
        vStatus.innerText = msg;
        vStatus.style.color = "var(--success)";
        
        // Handshake à¤•à¥‡ à¤¬à¤¾à¤¦ à¤¸à¥€à¤§à¥‡ à¤†à¤ªà¤•à¥‡ Citadel Dashboard à¤ªà¤° à¤°à¥€à¤¡à¤¾à¤¯à¤°à¥‡à¤•à¥à¤Ÿ
        setTimeout(() => { 
            window.location.href = "citadel.html"; 
        }, 1000);
    }

    // ðŸŸ¢ UPDATE 3: Real Identity Bridge
    async function loginWithIdentity() {
        const input = document.getElementById('identity-input').value.trim();
        if(!input) return;

        vStatus.innerText = "VERIFYING REAL SHARD...";
        vStatus.style.color = "var(--primary)";

        try {
            if(input.startsWith('{')) {
                const parsed = JSON.parse(input);
                if(parsed.pub) {
                    localStorage.setItem('sov_vault_key', input);
                    successRedirect("VAULT RESTORED");
                } else throw new Error();
            } else if(input.length > 30) {
                localStorage.setItem('sov_last_did', input);
                successRedirect("NODE RECOGNIZED");
            } else {
                throw new Error();
            }
        } catch(e) {
            vStatus.innerText = "INVALID IDENTITY FORMAT";
            vStatus.style.color = "var(--danger)";
        }
    }

    // --- ðŸ“¡ REAL MESH SYNC ---
    const gun = Gun(['https://gun-manhattan.herokuapp.com/gun', 'https://sov-relay.onrender.com/gun']);
    
    // Explorer Section à¤®à¥‡à¤‚ à¤¡à¥‡à¤Ÿà¤¾ à¤°à¥‡à¤‚à¤¡à¤° à¤•à¤°à¤¨à¤¾ (à¤…à¤—à¤° à¤¯à¥‚à¤œà¤° à¤‡à¤¸à¥€ à¤ªà¥‡à¤œ à¤ªà¤° à¤¦à¥‡à¤–à¤¨à¤¾ à¤šà¤¾à¤¹à¥‡)
    gun.get('sov_global_ledger').map().on((data, key) => {
        if(!data || !data.sender) return;
        const list = document.getElementById('explorer-list');
        if(!list) return;
        
        const row = document.createElement('div');
        row.className = 'tx-row';
        row.innerHTML = `
            <div>
                <i class="bi bi-box-seam" style="color:var(--primary)"></i> 
                <span>Shard: ${key.substring(0, 12)}...</span>
            </div>
            <div class="status-tag">VERIFIED</div>
        `;
        list.prepend(row);
        if(list.children.length > 8) list.lastElementChild.remove();
    });

    // ... (à¤¬à¤¾à¤•à¥€ renderPad à¤”à¤° window.onload à¤µà¥ˆà¤¸à¥‡ à¤¹à¥€ à¤°à¤¹à¥‡à¤‚à¤—à¥‡) ...
    function renderPad() {
        const pad = document.getElementById('pin-pad');
        pad.innerHTML = "";
        const nums = [1,2,3,4,5,6,7,8,9,0].sort(() => Math.random() - 0.5);
        nums.forEach(n => {
            const btn = document.createElement('button');
            btn.className = 'pad-btn'; btn.innerText = n;
            btn.onclick = () => handleInput(n);
            pad.appendChild(btn);
        });
    }

    function handleInput(num) {
        if (Date.now() < lockoutTime) {
            const left = Math.ceil((lockoutTime - Date.now()) / 1000);
            vStatus.innerText = `SECURITY LOCKOUT: ${left}s`;
            return;
        }
        currentInput += num;
        pinView.innerText = "*".repeat(currentInput.length);
        if(currentInput.length === 3) {
            if(currentInput === CORRECT_PIN) {
                successRedirect("IDENTITY AUTHENTICATED");
            } else {
                loginAttempts++;
                currentInput = ""; pinView.innerText = "***"; renderPad();
                if (loginAttempts >= MAX_ATTEMPTS) {
                    lockoutTime = Date.now() + LOCKOUT_DURATION;
                    vStatus.innerText = "ACCESS BLOCKED"; vStatus.style.color = "var(--danger)";
                } else {
                    vStatus.innerText = `INVALID: ${MAX_ATTEMPTS - loginAttempts} RETRIES`;
                    vStatus.style.color = "var(--danger)";
                }
            }
        }
    }

    window.onload = () => { renderPad(); vaultMsg.innerText = isNewUser ? "Initialize Sovereign Node" : "Validator Handshake Required"; };
</script>