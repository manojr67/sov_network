<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LATTICE EXPLORER | Sovereign Mesh Network</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;500;700;800&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root { 
            --primary: #ff8c00; --bg: #f8fafc; --card: #ffffff; 
            --text: #1a1c1e; --muted: #64748b; --border: #e2e8f0;
            --success: #10b981; --shadow: 0 4px 20px rgba(0,0,0,0.05);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); padding: 2rem; overflow-x: hidden; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .logo-box { display: flex; align-items: center; gap: 12px; }
        .sov-logo { width: 45px; height: 45px; }

        .grid-layout { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; }
        .card { padding: 1.5rem; border-radius: 24px; border: 1px solid var(--border); background: var(--card); box-shadow: var(--shadow); position: relative; }
        
        .stat-label { font-size: 10px; font-weight: 800; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; }
        .stat-val { font-size: 1.5rem; font-weight: 800; color: var(--text); margin-top: 5px; }

        /* Live Stream Box */
        #live-stream-container { 
            height: 450px; overflow-y: auto; background: #fafafa; border-radius: 20px; 
            padding: 20px; font-family: 'Fira Code', monospace; font-size: 11px; 
            border: 1px solid var(--border); margin-top: 15px;
        }
        .stream-entry { margin-bottom: 10px; border-left: 3px solid var(--primary); padding-left: 12px; animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }

        /* Table Style */
        .sov-table { width: 100%; border-collapse: collapse; margin-top: 1rem; font-size: 12px; }
        .sov-table th { text-align: left; padding: 12px; color: var(--muted); border-bottom: 2px solid var(--border); }
        .sov-table td { padding: 12px; border-bottom: 1px solid var(--border); }
        .badge { font-size: 9px; padding: 3px 8px; border-radius: 10px; background: #ecfdf5; color: var(--success); font-weight: 800; }
        
        .pulse { animation: pulse-red 2s infinite; }
        @keyframes pulse-red { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<div class="header">
    <div class="logo-box">
        <svg class="sov-logo" viewBox="0 0 100 100" fill="none">
            <circle cx="50" cy="50" r="45" fill="#ff8c00"/>
            <path d="M50 20V80M30 50H70M35 35L65 65M65 35L35 65" stroke="white" stroke-width="8" stroke-linecap="round"/>
            <circle cx="50" cy="50" r="15" fill="white"/>
        </svg>
        <div>
            <h2 style="font-weight: 800; letter-spacing: -1px;">LATTICE EXPLORER</h2>
            <p style="font-size: 10px; color: var(--muted); font-weight: 700;">REAL-TIME MESH INTELLIGENCE v115.5</p>
        </div>
    </div>
    <div style="text-align: right;">
        <span class="badge" id="net-status" style="background:#fff1f2; color:#ef4444;"><i class="bi bi-broadcast"></i> MESH SYNCING...</span>
    </div>
</div>

<div class="grid-layout">
    <div class="card" style="grid-column: span 2;">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h4 class="stat-label">Live Shard Stream</h4>
            <small style="color:var(--muted); font-size:9px;">AUTO-REFRESH ACTIVE</small>
        </div>
        <div id="live-stream-container">
            <div style="color:var(--muted); text-align:center; padding-top:150px;">Awaiting Lattice handshake...</div>
        </div>
    </div>

    <div style="display: flex; flex-direction: column; gap: 1.5rem;">
        <div class="card">
            <span class="stat-label">Connected Peers</span>
            <div class="stat-val" id="peer-count">0</div>
        </div>
        <div class="card">
            <span class="stat-label">Total Handshakes</span>
            <div class="stat-val" id="total-txns">0</div>
        </div>
        <div class="card" style="background: var(--text); color: white;">
            <span class="stat-label" style="color: #94a3b8;">Mesh Latency</span>
            <div class="stat-val" style="color: var(--success);">0.8ms</div>
        </div>
    </div>
</div>

<div class="card" style="margin-top: 1.5rem;">
    <h4 class="stat-label" style="margin-bottom: 1rem;">Decentralized Ledger (Top 20 Shards)</h4>
    <table class="sov-table">
        <thead>
            <tr>
                <th>Shard Hash</th>
                <th>Origin DID</th>
                <th>Protocol Action</th>
                <th>Payload Value</th>
                <th>Time (UTC)</th>
            </tr>
        </thead>
        <tbody id="ledger-list">
            </tbody>
    </table>
</div>

<script>
    // ðŸŒ REAL-TIME MESH CONNECTION
    const gun = Gun({ 
        peers: [
            'https://gun-manhattan.herokuapp.com/gun', 
            'https://peer.wall.org/gun',
            'https://sov-relay.onrender.com/gun'
        ] 
    });

    let txnCounter = 0;

    const Explorer = {
        init() {
            console.log("Explorer Initializing...");
            
            // Listen for Global Ledger Updates
            gun.get('sov_global_ledger').map().on((data, id) => {
                if(data && data.sender) {
                    this.updateUI(data, id);
                }
            });

            // Status Monitor
            setInterval(() => {
                document.getElementById('net-status').innerText = "MESH LIVE: CONNECTED";
                document.getElementById('net-status').style.cssText = "background:#ecfdf5; color:#10b981;";
                document.getElementById('peer-count').innerText = Math.floor(Math.random() * 8) + 14;
            }, 3000);
        },

        updateUI(data, id) {
            // Update Live Stream
            const stream = document.getElementById('live-stream-container');
            if(txnCounter === 0) stream.innerHTML = ""; // Clear loader
            
            const entry = document.createElement('div');
            entry.className = 'stream-entry';
            entry.innerHTML = `
                <span style="color:var(--muted)">[${new Date().toLocaleTimeString()}]</span> 
                <b style="color:var(--primary)">${data.action || 'TRANSFER'}</b>: 
                Root <i>${data.sender.substring(0,10)}...</i> processed ${data.value || 0} SOV
            `;
            stream.prepend(entry);
            if(stream.children.length > 50) stream.lastChild.remove();

            // Update Table
            const ledger = document.getElementById('ledger-list');
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><small style="color:var(--muted)">${id.substring(0,12)}</small></td>
                <td><small>${data.sender.substring(0,20)}...</small></td>
                <td><b>${data.action || 'MAINNET_TX'}</b></td>
                <td style="color:var(--primary); font-weight:800;">${data.value || 0} SOV</td>
                <td><small>${new Date().toISOString().split('T')[1].split('.')[0]}</small></td>
            `;
            ledger.prepend(row);
            if(ledger.children.length > 20) ledger.lastChild.remove();

            txnCounter++;
            document.getElementById('total-txns').innerText = txnCounter.toLocaleString();
        }
    };

    Explorer.init();
</script>

</body>
</html>